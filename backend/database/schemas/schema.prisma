// Aurum Vault Database Schema
// This is your Prisma schema file for the modern banking platform

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User Management
model User {
  id            String   @id @default(cuid())
  clerkUserId   String   @unique @map("clerk_user_id")
  email         String   @unique
  firstName     String   @map("first_name")
  lastName      String   @map("last_name")
  phone         String?
  dateOfBirth   DateTime? @map("date_of_birth")
  kycStatus     KycStatus @default(PENDING) @map("kyc_status")
  riskLevel     RiskLevel @default(LOW) @map("risk_level")
  tier          UserTier @default(STANDARD)
  isActive      Boolean  @default(true) @map("is_active")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  deletedAt     DateTime? @map("deleted_at")

  // Relations
  accounts      Account[]
  kycDocuments  KycDocument[]
  auditLogs     AuditLog[]
  sessions      UserSession[]

  @@map("users")
}

// Account Management
model Account {
  id               String      @id @default(cuid())
  userId           String      @map("user_id")
  accountNumber    String      @unique @map("account_number")
  accountType      AccountType @map("account_type")
  currency         String      @default("USD")
  balance          Decimal     @default(0.00) @db.Decimal(15, 2)
  availableBalance Decimal     @default(0.00) @map("available_balance") @db.Decimal(15, 2)
  status           AccountStatus @default(ACTIVE)
  interestRate     Decimal?    @map("interest_rate") @db.Decimal(5, 4)
  overdraftLimit   Decimal?    @map("overdraft_limit") @db.Decimal(10, 2)
  nickname         String?
  openedAt         DateTime    @default(now()) @map("opened_at")
  closedAt         DateTime?   @map("closed_at")
  createdAt        DateTime    @default(now()) @map("created_at")
  updatedAt        DateTime    @updatedAt @map("updated_at")

  // Relations
  user                User @relation(fields: [userId], references: [id])
  transactionsFrom    Transaction[] @relation("FromAccount")
  transactionsTo      Transaction[] @relation("ToAccount")
  wireTransfers       WireTransfer[]

  @@map("accounts")
}

// Transaction Processing
model Transaction {
  id               String            @id @default(cuid())
  fromAccountId    String?           @map("from_account_id")
  toAccountId      String?           @map("to_account_id")
  transactionType  TransactionType   @map("transaction_type")
  amount           Decimal           @db.Decimal(15, 2)
  currency         String
  exchangeRate     Decimal           @default(1.000000) @map("exchange_rate") @db.Decimal(10, 6)
  fee              Decimal           @default(0.00) @db.Decimal(10, 2)
  status           TransactionStatus @default(PENDING)
  referenceNumber  String            @unique @map("reference_number")
  description      String?
  metadata         Json?
  processedAt      DateTime?         @map("processed_at")
  createdAt        DateTime          @default(now()) @map("created_at")
  updatedAt        DateTime          @updatedAt @map("updated_at")

  // Relations
  fromAccount      Account? @relation("FromAccount", fields: [fromAccountId], references: [id])
  toAccount        Account? @relation("ToAccount", fields: [toAccountId], references: [id])
  wireTransfer     WireTransfer?

  @@map("transactions")
}

// Wire Transfer Management
model WireTransfer {
  id                    String              @id @default(cuid())
  transactionId         String              @unique @map("transaction_id")
  senderAccountId       String              @map("sender_account_id")
  recipientName         String              @map("recipient_name")
  recipientBankName     String              @map("recipient_bank_name")
  recipientBankSwift    String?             @map("recipient_bank_swift")
  recipientAccountNumber String             @map("recipient_account_number")
  recipientAddress      String?             @map("recipient_address")
  purposeCode           String?             @map("purpose_code")
  regulatoryInfo        Json?               @map("regulatory_info")
  complianceStatus      ComplianceStatus    @default(PENDING) @map("compliance_status")
  slaDeadline           DateTime?           @map("sla_deadline")
  approvedBy            String?             @map("approved_by")
  approvedAt            DateTime?           @map("approved_at")
  createdAt             DateTime            @default(now()) @map("created_at")
  updatedAt             DateTime            @updatedAt @map("updated_at")

  // Relations
  transaction           Transaction @relation(fields: [transactionId], references: [id])
  senderAccount         Account @relation(fields: [senderAccountId], references: [id])

  @@map("wire_transfers")
}

// Foreign Exchange Rates
model FxRate {
  id             String   @id @default(cuid())
  baseCurrency   String   @map("base_currency")
  targetCurrency String   @map("target_currency")
  rate           Decimal  @db.Decimal(10, 6)
  spread         Decimal  @default(0.0025) @db.Decimal(5, 4)
  effectiveFrom  DateTime @map("effective_from")
  effectiveTo    DateTime? @map("effective_to")
  provider       String?
  createdAt      DateTime @default(now()) @map("created_at")

  @@unique([baseCurrency, targetCurrency, effectiveFrom])
  @@map("fx_rates")
}

// KYC Document Management
model KycDocument {
  id                 String           @id @default(cuid())
  userId             String           @map("user_id")
  documentType       DocumentType     @map("document_type")
  filePath           String           @map("file_path")
  fileHash           String           @map("file_hash")
  verificationStatus VerificationStatus @default(PENDING) @map("verification_status")
  verifiedBy         String?          @map("verified_by")
  verifiedAt         DateTime?        @map("verified_at")
  expiresAt          DateTime?        @map("expires_at")
  createdAt          DateTime         @default(now()) @map("created_at")
  updatedAt          DateTime         @updatedAt @map("updated_at")

  // Relations
  user               User @relation(fields: [userId], references: [id])

  @@map("kyc_documents")
}

// Audit Trail
model AuditLog {
  id           String   @id @default(cuid())
  userId       String?  @map("user_id")
  action       String
  resourceType String   @map("resource_type")
  resourceId   String?  @map("resource_id")
  oldValues    Json?    @map("old_values")
  newValues    Json?    @map("new_values")
  ipAddress    String?  @map("ip_address")
  userAgent    String?  @map("user_agent")
  sessionId    String?  @map("session_id")
  createdAt    DateTime @default(now()) @map("created_at")

  // Relations
  user         User? @relation(fields: [userId], references: [id])

  @@map("audit_logs")
}

// User Session Management
model UserSession {
  id        String   @id @default(cuid())
  userId    String   @map("user_id")
  sessionId String   @unique @map("session_id")
  ipAddress String   @map("ip_address")
  userAgent String   @map("user_agent")
  isActive  Boolean  @default(true) @map("is_active")
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  user      User @relation(fields: [userId], references: [id])

  @@map("user_sessions")
}

// Enums
enum KycStatus {
  PENDING
  IN_REVIEW
  APPROVED
  REJECTED
  EXPIRED

  @@map("kyc_status")
}

enum RiskLevel {
  LOW
  MEDIUM
  HIGH
  CRITICAL

  @@map("risk_level")
}

enum UserTier {
  STANDARD
  PREMIUM
  PRIVATE
  INSTITUTIONAL

  @@map("user_tier")
}

enum AccountType {
  CHECKING
  SAVINGS
  INVESTMENT
  CREDIT
  LOAN

  @@map("account_type")
}

enum AccountStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  CLOSED

  @@map("account_status")
}

enum TransactionType {
  DEPOSIT
  WITHDRAWAL
  TRANSFER
  WIRE_TRANSFER
  FEE
  INTEREST
  ADJUSTMENT

  @@map("transaction_type")
}

enum TransactionStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
  REVERSED

  @@map("transaction_status")
}

enum ComplianceStatus {
  PENDING
  APPROVED
  REJECTED
  REQUIRES_REVIEW

  @@map("compliance_status")
}

enum DocumentType {
  PASSPORT
  DRIVERS_LICENSE
  NATIONAL_ID
  UTILITY_BILL
  BANK_STATEMENT
  TAX_DOCUMENT
  PROOF_OF_ADDRESS

  @@map("document_type")
}

enum VerificationStatus {
  PENDING
  VERIFIED
  REJECTED
  EXPIRED

  @@map("verification_status")
}