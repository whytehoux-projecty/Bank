<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Admin Payroll Management - Staff Portal" />
    <title>Payroll Management | Admin Portal</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="../css/styles.css" />
    <link rel="stylesheet" href="../css/dashboard.css" />
    <link rel="stylesheet" href="../css/admin.css" />
</head>

<body>
    <!-- Navigation Header -->
    <header class="main-header">
        <div class="header-left">
            <button class="icon-btn" onclick="toggleSidebar()" title="Toggle menu" aria-label="Toggle sidebar">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M3 5h14M3 10h14M3 15h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                </svg>
            </button>
            <div class="org-logo-small">
                <img src="../assets/logo.svg" alt="Staff Portal" />
            </div>
            <h1 class="portal-title">Admin Portal</h1>
        </div>

        <div class="header-right">
            <button class="icon-btn" title="Notifications" aria-label="Notifications">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path
                        d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z" />
                </svg>
                <span class="badge">3</span>
            </button>

            <div class="user-menu">
                <button class="user-btn" onclick="toggleUserMenu()" aria-label="User menu">
                    <div class="avatar">A</div>
                    <span>Admin</span>
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
                        <path d="M6 8L2 4h8L6 8z" />
                    </svg>
                </button>
                <div class="dropdown-menu" id="userDropdown">
                    <a href="#" onclick="logout()">Logout</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Admin Sidebar -->
    <aside class="admin-sidebar" id="adminSidebar">
        <div class="sidebar-section">
            <div class="sidebar-label">Main</div>
            <nav class="sidebar-menu">
                <a href="admin_interface.html" class="sidebar-item">
                    <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
                        <path
                            d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" />
                    </svg>
                    Dashboard
                </a>
                <a href="staff-management.html" class="sidebar-item">
                    <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
                        <path
                            d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z" />
                    </svg>
                    Staff Management
                </a>
                <a href="application-management.html" class="sidebar-item">
                    <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z"
                            clip-rule="evenodd" />
                    </svg>
                    Applications
                </a>
                <a href="loan-management.html" class="sidebar-item">
                    <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z" />
                        <path fill-rule="evenodd"
                            d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z"
                            clip-rule="evenodd" />
                    </svg>
                    Loan Management
                </a>
                <a href="payroll-management.html" class="sidebar-item active">
                    <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
                        <path
                            d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z" />
                        <path fill-rule="evenodd"
                            d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z"
                            clip-rule="evenodd" />
                    </svg>
                    Payroll
                </a>
            </nav>
        </div>
        <div class="sidebar-section">
            <div class="sidebar-label">Settings</div>
            <nav class="sidebar-menu">
                <a href="cms-settings.html" class="sidebar-item">
                    <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
                        <path
                            d="M5 4a1 1 0 00-2 0v7.268a2 2 0 000 3.464V16a1 1 0 102 0v-1.268a2 2 0 000-3.464V4zM11 4a1 1 0 10-2 0v1.268a2 2 0 000 3.464V16a1 1 0 102 0V8.732a2 2 0 000-3.464V4z" />
                    </svg>
                    CMS Settings
                </a>
            </nav>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content admin-main">
        <!-- Page Header -->
        <section class="page-header-admin">
            <div>
                <h1>üí∞ Payroll Management</h1>
                <p>Manage staff salaries, generate payslips, and process payments</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="exportPayroll()">üìä Export All</button>
                <button class="btn btn-primary" onclick="showRunPayrollModal()">‚ñ∂Ô∏è Run Payroll</button>
            </div>
        </section>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card primary">
                <div class="stat-icon">üë•</div>
                <div class="stat-value" id="totalStaff">0</div>
                <div class="stat-label">Total Staff</div>
            </div>
            <div class="stat-card success">
                <div class="stat-icon">üíµ</div>
                <div class="stat-value" id="totalPayroll">$0</div>
                <div class="stat-label">Total Monthly Payroll</div>
            </div>
            <div class="stat-card warning">
                <div class="stat-icon">‚è≥</div>
                <div class="stat-value" id="pendingPayments">0</div>
                <div class="stat-label">Pending Payments</div>
            </div>
            <div class="stat-card danger">
                <div class="stat-icon">üìÖ</div>
                <div class="stat-value" id="nextPayday">-</div>
                <div class="stat-label">Next Pay Day</div>
            </div>
        </div>

        <!-- Payroll Period Selector -->
        <div class="widget-card">
            <div class="widget-header">
                <h3 class="widget-title">üìÖ Payroll Period</h3>
            </div>
            <div class="widget-body">
                <div class="period-selector">
                    <div class="period-nav">
                        <button class="btn btn-secondary" onclick="prevPeriod()">‚Üê Previous</button>
                        <div class="current-period">
                            <select id="periodMonth" class="filter-select" onchange="loadPayrollData()"
                                aria-label="Select month">
                                <option value="1">January</option>
                                <option value="2">February</option>
                                <option value="3">March</option>
                                <option value="4">April</option>
                                <option value="5">May</option>
                                <option value="6">June</option>
                                <option value="7">July</option>
                                <option value="8">August</option>
                                <option value="9">September</option>
                                <option value="10">October</option>
                                <option value="11">November</option>
                                <option value="12">December</option>
                            </select>
                            <select id="periodYear" class="filter-select" onchange="loadPayrollData()"
                                aria-label="Select year">
                                <option value="2026">2026</option>
                                <option value="2025">2025</option>
                                <option value="2024">2024</option>
                            </select>
                        </div>
                        <button class="btn btn-secondary" onclick="nextPeriod()">Next ‚Üí</button>
                    </div>
                    <div class="period-status" id="periodStatus">
                        <span class="status-badge pending">Not Processed</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Staff Payroll Table -->
        <div class="widget-card">
            <div class="widget-header">
                <h3 class="widget-title">üìã Staff Payroll</h3>
                <div class="widget-actions">
                    <div class="search-box">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M11.5 7a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM10.7 11.3a6 6 0 111.414-1.414l3.387 3.386a1 1 0 01-1.414 1.414l-3.387-3.386z" />
                        </svg>
                        <input type="text" placeholder="Search staff..." id="searchInput" onkeyup="filterPayroll()" />
                    </div>
                    <select class="filter-select" id="departmentFilter" onchange="filterPayroll()"
                        aria-label="Filter by department">
                        <option value="all">All Departments</option>
                        <option value="engineering">Engineering</option>
                        <option value="marketing">Marketing</option>
                        <option value="finance">Finance</option>
                        <option value="hr">Human Resources</option>
                        <option value="sales">Sales</option>
                    </select>
                </div>
            </div>

            <!-- Bulk Actions -->
            <div class="bulk-actions" id="bulkActions">
                <span class="selected-count"><span id="selectedCount">0</span> selected</span>
                <button class="btn btn-secondary" onclick="bulkGeneratePayslips()">üìÑ Generate Payslips</button>
                <button class="btn btn-secondary" onclick="bulkSendPayslips()">üìß Email Payslips</button>
                <button class="btn btn-primary" onclick="bulkProcessPayments()">üí≥ Process Payments</button>
            </div>

            <div class="widget-body">
                <table class="data-table" id="payrollTable">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="selectAll" onchange="toggleSelectAll()"
                                    aria-label="Select all" /></th>
                            <th>Staff Member</th>
                            <th>Department</th>
                            <th>Basic Salary</th>
                            <th>Allowances</th>
                            <th>Deductions</th>
                            <th>Net Pay</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="payrollBody">
                        <!-- Will be populated dynamically -->
                    </tbody>
                </table>
            </div>

            <!-- Summary Footer -->
            <div class="payroll-summary">
                <div class="summary-item">
                    <span class="summary-label">Total Basic:</span>
                    <span class="summary-value" id="totalBasic">$0</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Total Allowances:</span>
                    <span class="summary-value" id="totalAllowances">$0</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Total Deductions:</span>
                    <span class="summary-value deduction" id="totalDeductions">$0</span>
                </div>
                <div class="summary-item total">
                    <span class="summary-label">Grand Total:</span>
                    <span class="summary-value" id="grandTotal">$0</span>
                </div>
            </div>

            <!-- Pagination -->
            <div class="pagination">
                <div class="pagination-info">
                    Showing <span id="showingFrom">1</span> to <span id="showingTo">10</span> of <span
                        id="totalRecords">0</span> records
                </div>
                <div class="pagination-buttons">
                    <button class="page-btn" onclick="prevPage()" aria-label="Previous page">‚Üê Previous</button>
                    <button class="page-btn active">1</button>
                    <button class="page-btn" onclick="nextPage()" aria-label="Next page">Next ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- Recent Payroll Activity -->
        <div class="widget-card">
            <div class="widget-header">
                <h3 class="widget-title">üìà Recent Payroll Activity</h3>
            </div>
            <div class="widget-body">
                <div class="activity-list" id="activityList">
                    <!-- Will be populated -->
                </div>
            </div>
        </div>
    </main>

    <!-- Run Payroll Modal -->
    <div class="modal-overlay" id="runPayrollModal">
        <div class="modal-container">
            <div class="modal-header">
                <h3>‚ñ∂Ô∏è Run Payroll</h3>
                <button class="modal-close" onclick="closeModal('runPayrollModal')"
                    aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="run-payroll-info">
                    <div class="info-card">
                        <span class="info-label">Period</span>
                        <span class="info-value" id="runPayrollPeriod">January 2026</span>
                    </div>
                    <div class="info-card">
                        <span class="info-label">Staff Count</span>
                        <span class="info-value" id="runPayrollStaff">25</span>
                    </div>
                    <div class="info-card">
                        <span class="info-label">Estimated Total</span>
                        <span class="info-value" id="runPayrollTotal">$125,000</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="autoGeneratePayslips" checked />
                        <span>Auto-generate payslips after processing</span>
                    </label>
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="autoEmailPayslips" />
                        <span>Auto-email payslips to staff</span>
                    </label>
                </div>
                <div class="warning-box">
                    <strong>‚ö†Ô∏è Warning:</strong> This action will process payroll for all active staff members for the
                    selected period. This cannot be undone.
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('runPayrollModal')">Cancel</button>
                <button class="btn btn-primary" onclick="confirmRunPayroll()">‚ñ∂Ô∏è Process Payroll</button>
            </div>
        </div>
    </div>

    <!-- Edit Payroll Modal -->
    <div class="modal-overlay" id="editPayrollModal">
        <div class="modal-container">
            <div class="modal-header">
                <h3>‚úèÔ∏è Edit Payroll Record</h3>
                <button class="modal-close" onclick="closeModal('editPayrollModal')"
                    aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="staff-header">
                    <div class="staff-avatar" id="editStaffAvatar">JS</div>
                    <div>
                        <div class="staff-name" id="editStaffName">John Smith</div>
                        <div class="staff-id" id="editStaffId">STF-1234</div>
                    </div>
                </div>
                <form id="editPayrollForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editBasicSalary">Basic Salary</label>
                            <input type="number" id="editBasicSalary" class="form-control" step="0.01" />
                        </div>
                        <div class="form-group">
                            <label for="editCurrency">Currency</label>
                            <select id="editCurrency" class="form-control">
                                <option value="USD">USD</option>
                                <option value="EUR">EUR</option>
                                <option value="GBP">GBP</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Allowances</label>
                        <div class="allowance-list" id="allowanceList">
                            <!-- Will be populated -->
                        </div>
                        <button type="button" class="btn btn-sm btn-secondary" onclick="addAllowance()">+ Add
                            Allowance</button>
                    </div>
                    <div class="form-group">
                        <label>Deductions</label>
                        <div class="deduction-list" id="deductionList">
                            <!-- Will be populated -->
                        </div>
                        <button type="button" class="btn btn-sm btn-secondary" onclick="addDeduction()">+ Add
                            Deduction</button>
                    </div>
                    <div class="net-pay-display">
                        <span class="label">Net Pay:</span>
                        <span class="value" id="calculatedNetPay">$0.00</span>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('editPayrollModal')">Cancel</button>
                <button class="btn btn-primary" onclick="savePayrollRecord()">üíæ Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="main-footer admin-footer">
        <div class="footer-content">
            <p>&copy; 2026 Global Organization. All rights reserved.</p>
            <div class="footer-links">
                <a href="#">Privacy Policy</a>
                <a href="#">Terms of Use</a>
                <a href="#">Help & Support</a>
            </div>
        </div>
    </footer>

    <script src="../js/api.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/common.js"></script>
    <script>
        // Sample data
        const samplePayroll = [
            { id: 'PAY-001', staffId: 'STF-1234', name: 'John Smith', department: 'engineering', basic: 5000, allowances: 800, deductions: 450, netPay: 5350, status: 'pending' },
            { id: 'PAY-002', staffId: 'STF-1235', name: 'Sarah Johnson', department: 'marketing', basic: 4500, allowances: 600, deductions: 400, netPay: 4700, status: 'pending' },
            { id: 'PAY-003', staffId: 'STF-1236', name: 'Michael Brown', department: 'finance', basic: 5500, allowances: 750, deductions: 500, netPay: 5750, status: 'paid' },
            { id: 'PAY-004', staffId: 'STF-1237', name: 'Emily Davis', department: 'hr', basic: 4800, allowances: 650, deductions: 420, netPay: 5030, status: 'pending' },
            { id: 'PAY-005', staffId: 'STF-1238', name: 'David Wilson', department: 'sales', basic: 4200, allowances: 900, deductions: 380, netPay: 4720, status: 'paid' },
            { id: 'PAY-006', staffId: 'STF-1239', name: 'Jessica Martinez', department: 'engineering', basic: 5200, allowances: 700, deductions: 470, netPay: 5430, status: 'pending' },
        ];

        const recentActivity = [
            { type: 'payroll', message: 'December 2025 payroll processed', time: '2 days ago' },
            { type: 'payslip', message: '25 payslips generated', time: '2 days ago' },
            { type: 'email', message: 'Payslips emailed to all staff', time: '2 days ago' },
            { type: 'update', message: 'John Smith salary updated', time: '5 days ago' },
        ];

        let payrollData = [...samplePayroll];
        let selectedRecords = [];

        // Utility functions
        const fmtCurrency = (n) => '$' + n.toLocaleString('en-US', { minimumFractionDigits: 2 });
        const getInitials = (name) => name.split(' ').map(n => n[0]).join('').toUpperCase();

        // Toggle functions
        function toggleUserMenu() {
            document.getElementById('userDropdown').classList.toggle('show');
        }

        function toggleSidebar() {
            document.getElementById('adminSidebar').classList.toggle('open');
        }

        // Modal functions
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('show');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        function showRunPayrollModal() {
            const month = document.getElementById('periodMonth');
            const year = document.getElementById('periodYear');
            document.getElementById('runPayrollPeriod').textContent = `${month.options[month.selectedIndex].text} ${year.value}`;
            document.getElementById('runPayrollStaff').textContent = payrollData.length;
            document.getElementById('runPayrollTotal').textContent = fmtCurrency(payrollData.reduce((sum, p) => sum + p.netPay, 0));
            openModal('runPayrollModal');
        }

        // Update stats
        function updateStats() {
            document.getElementById('totalStaff').textContent = payrollData.length;
            document.getElementById('totalPayroll').textContent = fmtCurrency(payrollData.reduce((sum, p) => sum + p.netPay, 0));
            document.getElementById('pendingPayments').textContent = payrollData.filter(p => p.status === 'pending').length;
            document.getElementById('nextPayday').textContent = 'Jan 25';
        }

        // Render payroll table
        function renderPayrollTable() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const dept = document.getElementById('departmentFilter').value;

            let filtered = payrollData;
            if (search) {
                filtered = filtered.filter(p => p.name.toLowerCase().includes(search) || p.staffId.toLowerCase().includes(search));
            }
            if (dept !== 'all') {
                filtered = filtered.filter(p => p.department === dept);
            }

            document.getElementById('totalRecords').textContent = filtered.length;
            document.getElementById('showingTo').textContent = Math.min(10, filtered.length);

            // Update totals
            const totals = filtered.reduce((acc, p) => ({
                basic: acc.basic + p.basic,
                allowances: acc.allowances + p.allowances,
                deductions: acc.deductions + p.deductions,
                net: acc.net + p.netPay
            }), { basic: 0, allowances: 0, deductions: 0, net: 0 });

            document.getElementById('totalBasic').textContent = fmtCurrency(totals.basic);
            document.getElementById('totalAllowances').textContent = fmtCurrency(totals.allowances);
            document.getElementById('totalDeductions').textContent = fmtCurrency(totals.deductions);
            document.getElementById('grandTotal').textContent = fmtCurrency(totals.net);

            const tbody = document.getElementById('payrollBody');
            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" class="empty-cell">No payroll records found</td></tr>';
                return;
            }

            tbody.innerHTML = filtered.map(p => `
          <tr class="${selectedRecords.includes(p.id) ? 'selected' : ''}">
            <td><input type="checkbox" ${selectedRecords.includes(p.id) ? 'checked' : ''} onchange="toggleSelect('${p.id}')" aria-label="Select ${p.name}" /></td>
            <td>
              <div class="staff-info">
                <div class="staff-avatar">${getInitials(p.name)}</div>
                <div class="staff-details">
                  <div class="staff-name">${p.name}</div>
                  <div class="staff-id">${p.staffId}</div>
                </div>
              </div>
            </td>
            <td class="capitalize">${p.department}</td>
            <td>${fmtCurrency(p.basic)}</td>
            <td class="positive">${fmtCurrency(p.allowances)}</td>
            <td class="negative">-${fmtCurrency(p.deductions)}</td>
            <td class="net-pay"><strong>${fmtCurrency(p.netPay)}</strong></td>
            <td><span class="status-badge ${p.status}">${p.status}</span></td>
            <td>
              <button class="action-btn view" onclick="viewPayroll('${p.id}')" title="View details">üëÅÔ∏è</button>
              <button class="action-btn edit" onclick="editPayroll('${p.id}')" title="Edit">‚úèÔ∏è</button>
              <button class="action-btn download" onclick="downloadPayslip('${p.id}')" title="Download payslip">üìÑ</button>
            </td>
          </tr>
        `).join('');
        }

        // Render activity
        function renderActivity() {
            const container = document.getElementById('activityList');
            container.innerHTML = recentActivity.map(a => `
          <div class="activity-item">
            <div class="activity-icon">${a.type === 'payroll' ? 'üí∞' : a.type === 'payslip' ? 'üìÑ' : a.type === 'email' ? 'üìß' : '‚úèÔ∏è'}</div>
            <div class="activity-content">
              <div class="activity-message">${a.message}</div>
              <div class="activity-time">${a.time}</div>
            </div>
          </div>
        `).join('');
        }

        // Selection handlers
        function toggleSelect(id) {
            if (selectedRecords.includes(id)) {
                selectedRecords = selectedRecords.filter(r => r !== id);
            } else {
                selectedRecords.push(id);
            }
            updateBulkActions();
            renderPayrollTable();
        }

        function toggleSelectAll() {
            const selectAll = document.getElementById('selectAll');
            if (selectAll.checked) {
                selectedRecords = payrollData.map(p => p.id);
            } else {
                selectedRecords = [];
            }
            updateBulkActions();
            renderPayrollTable();
        }

        function updateBulkActions() {
            const bulkActions = document.getElementById('bulkActions');
            document.getElementById('selectedCount').textContent = selectedRecords.length;
            bulkActions.style.display = selectedRecords.length > 0 ? 'flex' : 'none';
        }

        // Period navigation
        function prevPeriod() {
            const month = document.getElementById('periodMonth');
            const year = document.getElementById('periodYear');
            if (month.value == 1) {
                month.value = 12;
                year.value = parseInt(year.value) - 1;
            } else {
                month.value = parseInt(month.value) - 1;
            }
            loadPayrollData();
        }

        function nextPeriod() {
            const month = document.getElementById('periodMonth');
            const year = document.getElementById('periodYear');
            if (month.value == 12) {
                month.value = 1;
                year.value = parseInt(year.value) + 1;
            } else {
                month.value = parseInt(month.value) + 1;
            }
            loadPayrollData();
        }

        function loadPayrollData() {
            // Would fetch from API
            renderPayrollTable();
        }

        // Actions
        function editPayroll(id) {
            const record = payrollData.find(p => p.id === id);
            if (!record) return;

            document.getElementById('editStaffAvatar').textContent = getInitials(record.name);
            document.getElementById('editStaffName').textContent = record.name;
            document.getElementById('editStaffId').textContent = record.staffId;
            document.getElementById('editBasicSalary').value = record.basic;
            document.getElementById('calculatedNetPay').textContent = fmtCurrency(record.netPay);

            openModal('editPayrollModal');
        }

        function viewPayroll(id) {
            const record = payrollData.find(p => p.id === id);
            if (!record) return;
            alert(`Viewing payroll for ${record.name}\nBasic: ${fmtCurrency(record.basic)}\nNet Pay: ${fmtCurrency(record.netPay)}`);
        }

        function downloadPayslip(id) {
            showNotification('Downloading payslip...', 'info');
            setTimeout(() => showNotification('Payslip downloaded!', 'success'), 1500);
        }

        function savePayrollRecord() {
            showNotification('Payroll record updated!', 'success');
            closeModal('editPayrollModal');
        }

        function confirmRunPayroll() {
            showNotification('Processing payroll...', 'info');
            closeModal('runPayrollModal');
            setTimeout(() => {
                payrollData.forEach(p => p.status = 'paid');
                renderPayrollTable();
                showNotification('Payroll processed successfully!', 'success');
            }, 2000);
        }

        function filterPayroll() {
            renderPayrollTable();
        }

        function bulkGeneratePayslips() {
            showNotification(`Generating ${selectedRecords.length} payslips...`, 'info');
            setTimeout(() => showNotification('Payslips generated!', 'success'), 1500);
        }

        function bulkSendPayslips() {
            showNotification(`Sending ${selectedRecords.length} payslips by email...`, 'info');
            setTimeout(() => showNotification('Payslips sent!', 'success'), 1500);
        }

        function bulkProcessPayments() {
            showNotification(`Processing ${selectedRecords.length} payments...`, 'info');
            setTimeout(() => {
                selectedRecords.forEach(id => {
                    const p = payrollData.find(r => r.id === id);
                    if (p) p.status = 'paid';
                });
                selectedRecords = [];
                updateBulkActions();
                renderPayrollTable();
                showNotification('Payments processed!', 'success');
            }, 2000);
        }

        function exportPayroll() {
            showNotification('Exporting payroll data...', 'info');
            setTimeout(() => showNotification('Payroll exported!', 'success'), 1500);
        }

        function showNotification(message, type) {
            alert(`${type.toUpperCase()}: ${message}`);
        }

        // Initialize
        async function init() {
            // Set current month
            const now = new Date();
            document.getElementById('periodMonth').value = now.getMonth() + 1;
            document.getElementById('periodYear').value = now.getFullYear();

            updateStats();
            renderPayrollTable();
            renderActivity();
            updateBulkActions();
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', (event) => {
            if (!event.target.closest('.user-menu')) {
                document.getElementById('userDropdown')?.classList.remove('show');
            }
        });

        // Close modals when clicking outside
        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.classList.remove('show');
            });
        });

        document.addEventListener('DOMContentLoaded', init);
    </script>

    <style>
        /* Payroll Management Styles */
        .admin-sidebar {
            position: fixed;
            left: 0;
            top: 64px;
            bottom: 0;
            width: 260px;
            background: #fff;
            border-right: 1px solid #e2e8f0;
            padding: 24px 0;
            overflow-y: auto;
            z-index: 100;
        }

        .admin-main {
            margin-left: 260px;
        }

        .admin-footer {
            margin-left: 260px;
        }

        .sidebar-section {
            padding: 0 16px;
            margin-bottom: 24px;
        }

        .sidebar-label {
            font-size: 0.65rem;
            font-weight: 600;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 0 12px;
            margin-bottom: 8px;
        }

        .sidebar-menu {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 16px;
            color: #64748b;
            text-decoration: none;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .sidebar-item:hover {
            background: #f1f5f9;
            color: #1e293b;
        }

        .sidebar-item.active {
            background: linear-gradient(135deg, #1a365d, #2c5282);
            color: #fff;
        }

        /* Page Header */
        .page-header-admin {
            background: linear-gradient(135deg, #1a365d 0%, #2c5282 100%);
            border-radius: 16px;
            padding: 24px 32px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(26, 54, 93, 0.3);
        }

        .page-header-admin h1 {
            color: #fff;
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
        }

        .page-header-admin p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.875rem;
            margin: 4px 0 0;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e2e8f0;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
        }

        .stat-card.primary::before {
            background: #1a365d;
        }

        .stat-card.success::before {
            background: #38a169;
        }

        .stat-card.warning::before {
            background: #dd6b20;
        }

        .stat-card.danger::before {
            background: #e53e3e;
        }

        .stat-icon {
            font-size: 1.25rem;
            margin-bottom: 12px;
        }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #64748b;
        }

        /* Widget Card */
        .widget-card {
            background: #fff;
            border-radius: 16px;
            border: 1px solid #e2e8f0;
            overflow: hidden;
            margin-bottom: 24px;
        }

        .widget-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid #f1f5f9;
            background: linear-gradient(to right, #f8fafc, #fff);
        }

        .widget-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #1e293b;
            margin: 0;
        }

        .widget-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .widget-body {
            padding: 20px;
        }

        /* Period Selector */
        .period-selector {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .period-nav {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .current-period {
            display: flex;
            gap: 8px;
        }

        .period-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Search Box */
        .search-box {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            width: 220px;
        }

        .search-box input {
            border: none;
            outline: none;
            flex: 1;
            font-size: 0.875rem;
        }

        .filter-select {
            padding: 8px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.875rem;
            color: #64748b;
            background: #fff;
            cursor: pointer;
        }

        /* Bulk Actions */
        .bulk-actions {
            display: none;
            align-items: center;
            gap: 16px;
            padding: 12px 20px;
            background: #ebf4ff;
            border-bottom: 1px solid #bec3ff;
        }

        .selected-count {
            font-size: 0.875rem;
            font-weight: 600;
            color: #1a365d;
        }

        /* Data Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            padding: 12px 16px;
            text-align: left;
            font-size: 0.75rem;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            border-bottom: 1px solid #e2e8f0;
            background: #f8fafc;
        }

        .data-table td {
            padding: 16px;
            font-size: 0.875rem;
            color: #1e293b;
            border-bottom: 1px solid #f1f5f9;
        }

        .data-table tr:hover {
            background: #f8fafc;
        }

        .data-table tr.selected {
            background: #ebf4ff;
        }

        .staff-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .staff-avatar {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: linear-gradient(135deg, #1a365d, #2c5282);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .staff-name {
            font-weight: 600;
            color: #1e293b;
        }

        .staff-id {
            font-size: 0.75rem;
            color: #94a3b8;
        }

        .capitalize {
            text-transform: capitalize;
        }

        .positive {
            color: #38a169;
        }

        .negative {
            color: #e53e3e;
        }

        .net-pay {
            color: #1a365d;
        }

        .empty-cell {
            text-align: center;
            padding: 40px !important;
            color: #64748b;
        }

        /* Status Badge */
        .status-badge {
            display: inline-flex;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: capitalize;
        }

        .status-badge.pending {
            background: #fffaf0;
            color: #dd6b20;
        }

        .status-badge.paid {
            background: #f0fff4;
            color: #38a169;
        }

        .status-badge.processing {
            background: #ebf4ff;
            color: #1a365d;
        }

        /* Action Buttons */
        .action-btn {
            padding: 6px 8px;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            background: #f1f5f9;
        }

        .action-btn:hover {
            transform: scale(1.1);
        }

        .action-btn.edit {
            background: #ebf4ff;
        }

        .action-btn.download {
            background: #f0fff4;
        }

        /* Payroll Summary */
        .payroll-summary {
            display: flex;
            justify-content: flex-end;
            gap: 32px;
            padding: 16px 20px;
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
        }

        .summary-item {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .summary-label {
            font-size: 0.8rem;
            color: #64748b;
        }

        .summary-value {
            font-size: 0.9rem;
            font-weight: 600;
            color: #1e293b;
        }

        .summary-value.deduction {
            color: #e53e3e;
        }

        .summary-item.total {
            border-left: 2px solid #1a365d;
            padding-left: 16px;
        }

        .summary-item.total .summary-value {
            font-size: 1.1rem;
            color: #1a365d;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-top: 1px solid #f1f5f9;
        }

        .pagination-info {
            font-size: 0.875rem;
            color: #64748b;
        }

        .pagination-buttons {
            display: flex;
            gap: 4px;
        }

        .page-btn {
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            background: #fff;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
        }

        .page-btn.active {
            background: #1a365d;
            color: #fff;
            border-color: #1a365d;
        }

        /* Activity List */
        .activity-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px 16px;
            background: #f8fafc;
            border-radius: 10px;
        }

        .activity-icon {
            font-size: 1.25rem;
        }

        .activity-message {
            font-size: 0.875rem;
            color: #1e293b;
        }

        .activity-time {
            font-size: 0.75rem;
            color: #94a3b8;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-container {
            background: #fff;
            border-radius: 16px;
            width: 100%;
            max-width: 560px;
            max-height: 90vh;
            overflow-y: auto;
            margin: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.1rem;
            color: #1e293b;
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: none;
            background: #f1f5f9;
            color: #64748b;
            font-size: 1.25rem;
            cursor: pointer;
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            background: #f8fafc;
        }

        /* Run Payroll Modal */
        .run-payroll-info {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .info-card {
            background: #f8fafc;
            border-radius: 10px;
            padding: 16px;
            text-align: center;
        }

        .info-label {
            display: block;
            font-size: 0.75rem;
            color: #64748b;
            margin-bottom: 4px;
        }

        .info-value {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.9rem;
            color: #374151;
            cursor: pointer;
        }

        .checkbox-label input {
            width: 18px;
            height: 18px;
        }

        .warning-box {
            background: #fffaf0;
            border-left: 4px solid #dd6b20;
            padding: 16px;
            border-radius: 0 8px 8px 0;
            margin-top: 20px;
            font-size: 0.85rem;
            color: #92400e;
        }

        /* Edit Modal */
        .staff-header {
            display: flex;
            align-items: center;
            gap: 16px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e2e8f0;
            margin-bottom: 20px;
        }

        .staff-header .staff-avatar {
            width: 56px;
            height: 56px;
            font-size: 1.2rem;
        }

        .staff-header .staff-name {
            font-size: 1.1rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            font-size: 0.8rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 0.9rem;
        }

        .form-control:focus {
            outline: none;
            border-color: #1a365d;
        }

        .net-pay-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: linear-gradient(135deg, #1a365d, #2c5282);
            border-radius: 10px;
            color: #fff;
        }

        .net-pay-display .label {
            font-size: 0.9rem;
        }

        .net-pay-display .value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.75rem;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 1024px) {
            .admin-sidebar {
                transform: translateX(-100%);
            }

            .admin-sidebar.open {
                transform: translateX(0);
            }

            .admin-main,
            .admin-footer {
                margin-left: 0;
            }

            .payroll-summary {
                flex-wrap: wrap;
                gap: 16px;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .period-selector {
                flex-direction: column;
                gap: 16px;
            }

            .run-payroll-info {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>

</html>